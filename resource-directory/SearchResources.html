<apex:page controller="ResourceController_Search" 
  title="Resource Directory" 
  sidebar="false" 
  showHeader="false" 
  standardStylesheets="false" 
  applyHtmlTag="false" 
  applyBodyTag="false" 
  docType="html-5.0"
  >

  <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" lang="en">
  
  <apex:stylesheet value="{!$Resource.FormStyles}"/>

  <style>
    div.rsc { border-style:solid; border-color:LightGray; border-width:thin; margin-left:1em; float:left; }
    div.gm-style-iw { overflow:hidden!important; }
    label.cbtab { display:inline-block; width:8em; }
  </style>
  
  <apex:form style="width:900px; margin:auto; margin-top:2em;" >
  
    <apex:includeScript value="{!$Resource.FormSupport}"/>
    <apex:includeScript value="https://maps.googleapis.com/maps/api/js?sensor=false"/>
    
    <apex:actionFunction name="runSearch" action="{!runSearch}" reRender="results">
      <apex:param name="query" value=""/>
    </apex:actionFunction>


<head>

  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>Resource Directory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <apex:slds />


    <script>
      var map;
      var markers = [];
      var infoWindow;
      var geoLoc;
      var validLoc = false;
      
      var searchLimit = 25;
      var firstSearch = true;
      
      window.onload = function()
      {
          map = new google.maps.Map(document.getElementById("map"), {
                      center: new google.maps.LatLng(39.8, -98.6),
                      zoom: 4,
                      mapTypeId: google.maps.MapTypeId.ROADMAP });
                      
          infoWindow = new google.maps.InfoWindow();
      };
      
      function clearMap()
      {
          infoWindow.close();
          
          for(var i = 0; i < markers.length; i++)
          {
              markers[i].setMap(null);
          }
          
          while(markers.length > 0) { markers.pop(); }
      };      
      
      function addMarker(name, id, lat, lng, desc)
      {
          var html = "<a href=\"{!$Page.Resource_Info}?id=" + id 
                      + "\" onclick=\"window.open(this.href, '', 'width=480,height=480'); return false;\">" 
                      + name + "</a><br/>" + "<p style=\"width:20em;\">" + desc + "</p>";
          
          var marker = new google.maps.Marker({ map: map, position: new google.maps.LatLng(lat,lng) });
          
          google.maps.event.addListener(marker, "click", 
              function()
              {
                  infoWindow.setContent(html);
                  infoWindow.open(map, marker);
              });
          
          markers.push(marker);
      };
      
      function centerMap()
      {
          if(markers.length == 1)
          {
              map.setCenter(markers[0].getPosition());
              map.setZoom(15);
          }
          else if(markers.length > 1)
          {
              var bounds = new google.maps.LatLngBounds();
          
              for(var i = 0; i < markers.length; i++)
              {
                  bounds.extend(markers[i].getPosition());
              }
          
              map.fitBounds(bounds);
          }
      };
      
      function updateLocation()
      {
          validLoc = false;
          
          if(valid(document.getElementById("location").value))
          {
              var geocoder = new google.maps.Geocoder();

              geocoder.geocode({address: document.getElementById("location").value}, 
                  function(results, status)
                  {
                      if(status == google.maps.GeocoderStatus.OK)
                      {
                          geoLoc = results[0].geometry.location;
                          validLoc = true;
                          search();
                      }
                  });
          }
          else
          {
              search();
          }
      };
      
      function resultsHelp(numResults)
      {
          if(numResults == searchLimit)
          {
              document.getElementById("resultsHelp").innerHTML = "Results limit reached.  Try refining your search.";
          }
          else if(numResults == 0 && !firstSearch)
          {
              document.getElementById("resultsHelp").innerHTML = "No results found.  Try refining your search.";
          }
          else
          {
              document.getElementById("resultsHelp").innerHTML = "";
          }

          firstSearch = false;      
      };

      function search()
      {
          var query = "select Id, Name, Short_Description__c, Location__latitude__s, Location__longitude__s";
          query += " from Resource__c where Public__c = true";
          
          if(document.getElementById("category").selectedIndex != 0)
          {
              query += " and Primary_Category__c = '"
                  + document.getElementById("category").options[document.getElementById("category").selectedIndex].value
                  + "'";
          }

          if(document.getElementById("accessible").checked) { query += " and Accessible_to_Disabled__c = true"; }
          if(document.getElementById("safeHaven").checked) { query += " and Safe_Haven__c = true"; }
          if(document.getElementById("viaPhone").checked) { query += " and Counseling_by_Phone__c = true"; }
          if(document.getElementById("onlineSvc").checked) { query += " and Online_Services__c = true"; }
          if(document.getElementById("liveChat").checked) { query += " and Live_Chat__c = true"; }
          if(document.getElementById("affordable").checked) { query += " and Affordable_Free_Service__c = true"; }
          
          if(valid(document.getElementById("language").value))
          {
              query += " and Available_Languages__c like '%" + document.getElementById("language").value + "%'";
          }
          
          var tags = "";
          if(document.getElementById("suicide").checked) { tags += ";Suicide"; }
          if(document.getElementById("depression").checked) { tags += ";Depression"; }
          if(document.getElementById("bipolar").checked) { tags += ";Bipolar"; }
          if(document.getElementById("anxiety").checked) { tags += ";Anxiety"; }
          if(document.getElementById("substanceUse").checked) { tags += ";Substance Use"; }
          if(document.getElementById("eatingDisorder").checked) { tags += ";Eating Disorder"; }
          if(document.getElementById("selfHarm").checked) { tags += ";Self Harm"; }
          if(document.getElementById("bullying").checked) { tags += ";Bullying"; }
          if(document.getElementById("ptsd").checked) { tags += ";Post-Traumatic Stress Disorder"; }
          if(document.getElementById("survivor").checked) { tags += ";Survivor Services"; }
          if(document.getElementById("selfHelp").checked) { tags += ";Self Help"; }
          if(document.getElementById("provider").checked) { tags += ";Licensed Provider"; }
          if(document.getElementById("hospital").checked) { tags += ";Hospital"; }
          if(document.getElementById("fitness").checked) { tags += ";Fitness"; }
          if(document.getElementById("nutrition").checked) { tags += ";Nutrition"; }
          if(document.getElementById("nonprofit").checked) { tags += ";Non-profit"; }
          if(document.getElementById("child").checked) { tags += ";Child"; }
          if(document.getElementById("adolescent").checked) { tags += ";Adolescent"; }
          if(document.getElementById("adult").checked) { tags += ";Adult"; }
          if(document.getElementById("senior").checked) { tags += ";Senior"; }
          if(document.getElementById("activityGroup").checked) { tags += ";Activity Group"; }
          if(document.getElementById("peerSupport").checked) { tags += ";Peer Support"; }
          if(document.getElementById("military").checked) { tags += ";Military"; }
          if(document.getElementById("lgbtqia").checked) { tags += ";LGBTQIA"; }
          if(document.getElementById("victim").checked) { tags += ";Victim"; }
          if(document.getElementById("raceEthnic").checked) { tags += ";Race/Ethnic Specific"; }
          if(tags.length > 0)
          {
              query += " and Tags__c includes ('" + tags.substring(1) + "')";
          }
          
          if(validLoc)
          {
              query += " and DISTANCE(Location__c, GEOLOCATION(" + geoLoc.lat() + "," + geoLoc.lng() + "), 'mi') < "
                          + document.getElementById("radius").options[document.getElementById("radius").selectedIndex].value;
                          
              query += " order by DISTANCE(Location__c, GEOLOCATION(" + geoLoc.lat() + "," + geoLoc.lng() + "), 'mi')";
          }
          else
          {
              query += " order by Name asc";
          }
          
          query += " limit " + searchLimit;
          
          clearMap();
          
          runSearch(query);
      };
    </script>

</head>

<body>
  <!-- REQUIRED SLDS WRAPPER -->
  <div class="slds-scope">
    <!-- MASTHEAD -->
    <p class="slds-text-heading--label slds-m-bottom--small">
      Welcome to our database of free mental wellness services. This ever-growing database is free to use and accessible 24/7/365. 
      Do you know of a great service in your area? Please <a href="{!$Page.Resource_Submission}">add it here</a>. 
    </p>

    <div class="myapp">
      <div style="height: 660px;">
      
      
      
      
      
      
      
      
      
      
      
  <div class="slds-grid slds-has-coordinates" style="display: flex;flex-wrap: wrap; width: 70vw">
    <div class="slds-map_container">
      <div class="slds-map">
        <iframe id="GoogleMapID" title="Google Maps iframe" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyAtCW0TXBOXDh0jP1q58ZWNMID0ZYOg32w&q=place_id:ChIJsTvHHKUsDogRTN4FQXxpP-U"></iframe>
      </div>
    </div>
    <div class="slds-coordinates">
      <div class="slds-coordinates__header">
        <h2 class="slds-coordinates__title">Salesforce Locations In United States (9)</h2>
      </div>
      <ul class="slds-coordinates__list">
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">Worldwide Corporate Headquarters</span>
              <span>The Landmark @ One Market, San Francisco, CA</span>
            </span>
          </button>
        </li>
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">salesforce.com inc Atlanta</span>
              <span>950 East Paces Ferry Road NE, Atlanta, GA</span>
            </span>
          </button>
        </li>
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">salesforce.com inc Bellevue</span>
              <span>929 108th Ave NE, Bellevue, WA</span>
            </span>
          </button>
        </li>
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">salesforce.com inc Boston</span>
              <span>500 Boylston Street 19th Floor, Boston, MA</span>
            </span>
          </button>
        </li>
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">salesforce.com inc Chicago</span>
              <span>111 West Illinois Street, Chicago, IL</span>
            </span>
          </button>
        </li>
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">salesforce.com inc Herndon</span>
              <span>2550 Wasser Terrace, Herndon, VA</span>
            </span>
          </button>
        </li>
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">salesforce.com inc Hillsboro</span>
              <span>2035 NE Cornelius Pass Road, Hillsboro, OR</span>
            </span>
          </button>
        </li>
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">salesforce.com inc Indy</span>
              <span>111 Monument Circle, Indianapolis, IN</span>
            </span>
          </button>
        </li>
        <li class="slds-coordinates__item">
          <span class="slds-assistive-text" aria-live="polite"></span>
          <button class="slds-coordinates__item-action slds-button_reset slds-media" aria-pressed="false">
            <span class="slds-media__figure">
              <span class="slds-icon_container slds-icon-standard-account" title="Description of icon when needed">
                <svg class="slds-icon" aria-hidden="true">
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#account" />
                </svg>
                <span class="slds-assistive-text">Description of icon when needed</span>
              </span>
            </span>
            <span class="slds-media__body">
              <span class="slds-text-link">salesforce.com inc Irvine</span>
              <span>300 Spectrum Center Drive, Irvine, CA</span>
            </span>
          </button>
        </li>
      </ul>
    </div>
  </div>
</div>
    </div>
    <!-- / PRIMARY CONTENT WRAPPER -->
  </div>
  <!-- / REQUIRED SLDS WRAPPER -->
</body>

</apex:form>
</html>
</apex:page>